<!DOCTYPE html>
<html>
<head>
    <title>å­¦ç¿’ã™ã‚‹ç°¡æ˜“AI (ä¿å­˜æ©Ÿèƒ½ä»˜ã)</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 90vh;
        }
        .chat-container {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background-color: #007bff;
            color: white;
            padding: 15px;
            font-size: 1.2em;
            text-align: center;
            border-bottom: 1px solid #0056b3;
        }
        .chat-box {
            height: 400px;
            padding: 15px;
            overflow-y: auto;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 70%;
            word-wrap: break-word;
        }
        .user-message {
            align-self: flex-end;
            background-color: #dcf8c6;
            color: #333;
        }
        .ai-message {
            align-self: flex-start;
            background-color: #e2e2e2;
            color: #333;
        }
        .train-message {
            align-self: flex-start;
            background-color: #ffe0b2;
            font-size: 0.9em;
            color: #666;
        }
        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        .chat-input input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            margin-right: 10px;
            font-size: 1em;
        }
        .chat-input button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 18px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .chat-input button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            å­¦ç¿’ã™ã‚‹ãŠã—ã‚ƒã¹ã‚ŠAI ğŸ“šğŸ’¾
        </div>
        <div class="chat-box" id="chatBox">
            </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
            <button onclick="sendMessage()">é€ä¿¡</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const KNOWLEDGE_KEY = 'ai_knowledge_base'; // localStorageã«ä¿å­˜ã™ã‚‹ã‚­ãƒ¼å

        // AIãŒå­¦ç¿’ã—ãŸçŸ¥è­˜ã‚’ä¿å­˜ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        // ã¾ãšã¯localStorageã‹ã‚‰èª­ã¿è¾¼ã¿ã€ãªã‘ã‚Œã°åˆæœŸå€¤ã‚’è¨­å®š
        let knowledgeBase = {};

        // --- åˆæœŸåŒ–å‡¦ç† ---
        function initializeAI() {
            // localStorageã‹ã‚‰çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã‚€
            const savedKnowledge = localStorage.getItem(KNOWLEDGE_KEY);
            if (savedKnowledge) {
                try {
                    knowledgeBase = JSON.parse(savedKnowledge);
                    addMessage('ai', 'ãŠã‹ãˆã‚Šãªã•ã„ï¼å‰å›ã®å­¦ç¿’å†…å®¹ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚ğŸ˜Š');
                } catch (e) {
                    console.error("localStorageã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e);
                    knowledgeBase = getDefaultKnowledge();
                    addMessage('ai', 'ã“ã‚“ã«ã¡ã¯ï¼æ–°ã—ã„å­¦ç¿’ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚');
                }
            } else {
                knowledgeBase = getDefaultKnowledge();
                addMessage('ai', 'ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹è©±ã—ã‹ã‘ã¦ã¿ã¦ã­ã€‚');
            }
            addMessage('ai', 'çŸ¥ã‚‰ãªã„è¨€è‘‰ãŒã‚ã£ãŸã‚‰ã€Œ**[ãã®è¨€è‘‰] ã¨ã¯ [æ„å‘³]**ã€ã¨æ•™ãˆã¦ãã‚Œã‚‹ã¨è¦šãˆã‚‹ã‚ˆï¼', true); // isTrainingã‚’trueã«ã—ã¦å¼·èª¿
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹
        function getDefaultKnowledge() {
            return {
                "ã“ã‚“ã«ã¡ã¯": "ã“ã‚“ã«ã¡ã¯ï¼ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ",
                "ã‚ã‚ŠãŒã¨ã†": "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼ãŠå½¹ã«ç«‹ã¦ã¦å¬‰ã—ã„ã§ã™ï¼",
                "å¤©æ°—": "ä»Šæ—¥ã®å¤©æ°—ã¯æ™´ã‚Œã®ã‚ˆã†ã§ã™ã­ï¼æ°—æŒã¡ã®è‰¯ã„ä¸€æ—¥ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ã€‚â˜€ï¸",
                "åå‰": "ç§ã®åå‰ã¯ç°¡æ˜“å­¦ç¿’AIã ã‚ˆã€‚"
            };
        }

        // çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’localStorageã«ä¿å­˜ã™ã‚‹é–¢æ•°
        function saveKnowledge() {
            try {
                localStorage.setItem(KNOWLEDGE_KEY, JSON.stringify(knowledgeBase));
            } catch (e) {
                console.error("localStorageã¸ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:", e);
                addMessage('ai', 'ã”ã‚ã‚“ãªã•ã„ã€å­¦ç¿’å†…å®¹ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸâ€¦ã€‚');
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ ã™ã‚‹é–¢æ•°
        function addMessage(sender, text, isTraining = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            if (isTraining) {
                messageDiv.classList.add('train-message');
            }
            messageDiv.innerHTML = text; // HTMLã‚¿ã‚°ã‚’è§£é‡ˆã§ãã‚‹ã‚ˆã†ã«innerHTMLã‚’ä½¿ç”¨
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // ä¸€ç•ªä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        }

        // AIã®å¿œç­”ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ï¼ˆå­¦ç¿’ã¨å¿œç­”ï¼‰
        function generateResponse(message) {
            const lowerCaseMessage = message.toLowerCase(); // å°æ–‡å­—ã«å¤‰æ›ã—ã¦å‡¦ç†

            // å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã®åˆ¤å®šï¼šã€Œ[è¨€è‘‰] ã¨ã¯ [æ„å‘³]ã€ã®å½¢å¼ã‚’ãƒã‚§ãƒƒã‚¯
            const trainMatch = lowerCaseMessage.match(/(.+) ã¨ã¯ (.+)/);
            if (trainMatch) {
                const keyword = trainMatch[1].trim();
                const meaning = trainMatch[2].trim();
                knowledgeBase[keyword] = meaning; // çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ 
                saveKnowledge(); // å­¦ç¿’ã—ãŸã‚‰ä¿å­˜ï¼
                addMessage('ai', `ã€Œ**${keyword}**ã€ã¯ã€Œ**${meaning}**ã€ã¨ã—ã¦è¦šãˆãŸã‚ˆï¼ã‚ã‚ŠãŒã¨ã†ï¼`, true);
                return null; // AIã‹ã‚‰ã®å³æ™‚å¿œç­”ã¯ãªã—
            }

            // çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å¿œç­”ã‚’æ¢ã™
            for (const key in knowledgeBase) {
                if (lowerCaseMessage.includes(key)) {
                    return knowledgeBase[key];
                }
            }

            // çŸ¥ã‚‰ãªã„å ´åˆ
            return "ã”ã‚ã‚“ãªã•ã„ã€ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã—ã‚ˆã‘ã‚Œã°ã€Œ**[ãã®è¨€è‘‰] ã¨ã¯ [æ„å‘³]**ã€ã¨æ•™ãˆã¦ãã‚Œã‚‹ã¨è¦šãˆã‚‹ã‚ˆï¼";
        }

        // é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
        function sendMessage() {
            const message = userInput.value.trim(); // å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
            if (message === '') return; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã®å ´åˆã¯ä½•ã‚‚ã—ãªã„

            addMessage('user', message); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ 
            userInput.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢

            // AIã®å¿œç­”ã‚’å°‘ã—é…ã‚‰ã›ã¦è‡ªç„¶ã«è¦‹ã›ã‚‹
            setTimeout(() => {
                const aiResponse = generateResponse(message);
                if (aiResponse) { // å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ã§ãªã‘ã‚Œã°å¿œç­”
                    addMessage('ai', aiResponse); // AIã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ 
                }
            }, 500); // 0.5ç§’å¾Œã«å¿œç­”
        }

        // Enterã‚­ãƒ¼ã§é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«AIã‚’åˆæœŸåŒ–ã™ã‚‹
        initializeAI();
    </script>
</body>
</html>
