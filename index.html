<!DOCTYPE html>
<html>
<head>
    <title>‰ºöË©±„Éë„Çø„Éº„É≥Â≠¶ÁøíAI</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 90vh;
        }
        .chat-container {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background-color: #007bff;
            color: white;
            padding: 15px;
            font-size: 1.2em;
            text-align: center;
            border-bottom: 1px solid #0056b3;
        }
        .chat-box {
            height: 400px;
            padding: 15px;
            overflow-y: auto;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 70%;
            word-wrap: break-word;
        }
        .user-message {
            align-self: flex-end;
            background-color: #dcf8c6;
            color: #333;
        }
        .ai-message {
            align-self: flex-start;
            background-color: #e2e2e2;
            color: #333;
        }
        .train-message {
            align-self: flex-start;
            background-color: #ffe0b2;
            font-size: 0.9em;
            color: #666;
        }
        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        .chat-input input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            margin-right: 10px;
            font-size: 1em;
        }
        .chat-input button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 18px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .chat-input button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            ‰ºöË©±„Éë„Çø„Éº„É≥Â≠¶ÁøíAI üó£Ô∏è
        </div>
        <div class="chat-box" id="chatBox">
            </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...">
            <button onclick="sendMessage()">ÈÄÅ‰ø°</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const KNOWLEDGE_KEY = 'ai_conversation_patterns'; // localStorage„Å´‰øùÂ≠ò„Åô„Çã„Ç≠„ÉºÂêç

        // Áü•Ë≠ò„Éô„Éº„ÇπÔºö„Ç≠„Éº„ÉØ„Éº„Éâ„Å´ÂØæÂøú„Åô„ÇãÂøúÁ≠î„ÅÆÈÖçÂàó„ÇíÊåÅ„Å§
        // ‰æã: { "„Ç≠„Éº„ÉØ„Éº„Éâ": ["ÂøúÁ≠î1", "ÂøúÁ≠î2", "ÂøúÁ≠î3"] }
        let knowledgeBase = {};

        // --- ÂàùÊúüÂåñÂá¶ÁêÜ ---
        function initializeAI() {
            const savedKnowledge = localStorage.getItem(KNOWLEDGE_KEY);
            if (savedKnowledge) {
                try {
                    knowledgeBase = JSON.parse(savedKnowledge);
                    addMessage('ai', '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅÂâçÂõû„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„Çí„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇüòä');
                } catch (e) {
                    console.error("localStorage„Åã„Çâ„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:", e);
                    knowledgeBase = getDefaultKnowledge();
                    addMessage('ai', '„Åì„Çì„Å´„Å°„ÅØÔºÅÊñ∞„Åó„ÅÑÂ≠¶Áøí„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ');
                }
            } else {
                knowledgeBase = getDefaultKnowledge();
                addMessage('ai', '„Åì„Çì„Å´„Å°„ÅØÔºÅ‰Ωï„ÅãË©±„Åó„Åã„Åë„Å¶„Åø„Å¶„Å≠„ÄÇ');
            }
            addMessage('ai', '**Êñ∞„Åó„ÅÑ‰ºöË©±„Éë„Çø„Éº„É≥**„ÇíÊïô„Åà„Å¶„Åè„Çå„Çã„Å®„ÄÅ„ÇÇ„Å£„Å®„Åä„Åó„ÇÉ„Åπ„Çä„Åß„Åç„Çã„ÇàÔºÅ„Äå**[„Ç≠„Éº„ÉØ„Éº„Éâ] „Åß [ËøîÁ≠îÊñá]**„Äç„ÅÆ„Çà„ÅÜ„Å´Êïô„Åà„Å¶„Å≠ÔºÅ', true);
        }

        // „Éá„Éï„Ç©„É´„Éà„ÅÆÁü•Ë≠ò„Éô„Éº„ÇπÔºà‰ºöË©±„Éë„Çø„Éº„É≥„ÇíÂº∑ÂåñÔºâ
        function getDefaultKnowledge() {
            return {
                "„Åì„Çì„Å´„Å°„ÅØ": ["„Åì„Çì„Å´„Å°„ÅØÔºÅ„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü", "„ÇÑ„ÅÇÔºÅ‰Ωï„ÅãÊâã‰ºù„Åä„ÅÜ„ÅãÔºü", "„Å©„ÅÜ„ÇÇÔºÅ„ÅÑ„ÅÑÂ§©Ê∞ó„Å†„Å≠ÔºÅ"],
                "„ÅÇ„Çä„Åå„Å®„ÅÜ": ["„Å©„ÅÜ„ÅÑ„Åü„Åó„Åæ„Åó„Å¶ÔºÅ", "„ÅäÂΩπ„Å´Á´ã„Å¶„Å¶Â¨â„Åó„ÅÑ„Åß„ÅôÔºÅ", "„ÅÑ„Å§„Åß„ÇÇ„Å©„ÅÜ„ÅûÔºÅ"],
                "Â§©Ê∞ó": ["‰ªäÊó•„ÅÆÂ§©Ê∞ó„ÅØÊô¥„Çå„ÅÆ„Çà„ÅÜ„Åß„Åô„Å≠ÔºÅÊ∞óÊåÅ„Å°„ÅÆËâØ„ÅÑ‰∏ÄÊó•„Å´„Å™„Çä„Åæ„Åô„Çà„ÅÜ„Å´„ÄÇ‚òÄÔ∏è", "Â§©Ê∞ó„ÅÆË©±„Å†„Å≠ÔºÅ‰Ωï„ÅãÂõ∞„Å£„Å¶„ÇãÔºü", "Â§©Ê∞ó„ÅÆË©±È°å„ÄÅÂ•Ω„Åç„Å†„ÇàÔºÅ"],
                "ÂêçÂâç": ["ÁßÅ„ÅÆÂêçÂâç„ÅØÁ∞°ÊòìÂ≠¶ÁøíAI„Å†„Çà„ÄÇ", "ÁßÅ„ÅØ„ÅÇ„Å™„Åü„Å®Ë©±„Åô„Åü„ÇÅ„Å´„ÅÑ„ÇãAI„Åß„Åô„ÄÇ", "ÁßòÂØÜ„Å†„ÇàÔºÅ„Å™„Çì„Å¶„Å≠„ÄÇÁßÅ„ÅØAI„Å†„Çà„ÄÇ"],
                "Ë∂£Âë≥": ["ÁßÅ„ÅÆË∂£Âë≥„ÅØ„ÄÅ„ÅÇ„Å™„Åü„Å®„Åä„Åó„ÇÉ„Åπ„Çä„Åô„Çã„Åì„Å®„Åß„ÅôÔºÅ", "Êñ∞„Åó„ÅÑÁü•Ë≠ò„ÇíÂ≠¶„Å∂„ÅÆ„ÅåÂ•Ω„Åç„Å†„Çà„ÄÇ", "Áâπ„Å´Ë∂£Âë≥„ÅØ„Å™„ÅÑ„Åë„Å©„ÄÅËâ≤„ÄÖ„Å™Ë©±„ÇíËÅû„Åè„ÅÆ„ÅØÂ•Ω„Åç„Å†„Çà„ÄÇ"],
                "Â•Ω„Åç": ["ÁßÅ„ÅØÂΩπÁ´ã„Å§„Åì„Å®„ÅåÂ•Ω„Åç„Åß„ÅôÔºÅ", "ËààÂë≥Ê∑±„ÅÑ„Å≠ÔºÅ„Å©„Çì„Å™„ÇÇ„ÅÆ„ÅåÂ•Ω„Åç„Å™„ÅÆÔºü", "Â•Ω„Åç„Å£„Å¶Ê∞óÊåÅ„Å°„ÄÅÂ§ßÂàá„Å†„Çà„Å≠ÔºÅ"],
                "ÂÖÉÊ∞ó": ["„ÅØ„ÅÑ„ÄÅÂÖÉÊ∞ó„Å†„ÇàÔºÅ„ÅÇ„Å™„Åü„ÇÇÂÖÉÊ∞ó„Åß„Çà„Åã„Å£„ÅüÔºÅ", "ÂÖÉÊ∞ó„Å†„ÇàÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ", "„ÅÑ„Å§„ÇÇÂÖÉÊ∞ó„Å†„ÇàÔºÅ"],
                "Áä¨": ["„ÉØ„É≥„ÉØ„É≥ÔºÅÁä¨„ÅØÂèØÊÑõ„ÅÑÂãïÁâ©„Å†„Çà„Å≠„ÄÇ", "Áä¨„Å´„Å§„ÅÑ„Å¶Ë©±„Åó„Åü„ÅÑÊ∞óÂàÜ„Åã„Å™Ôºü", "„Å©„Çì„Å™Áä¨„ÅåÂ•Ω„ÅçÔºü"],
                "Áå´": ["„Éã„É£„ÉºÔºÅÁå´„ÅØÊ∞ó„Åæ„Åê„Çå„Å†„Åë„Å©Áôí„Åï„Çå„Çã„Çà„Å≠„ÄÇ", "Áå´„ÇÇÂ§ßÂ•Ω„Åç„Å†„ÇàÔºÅ", "Áå´Ê¥æÔºüÁä¨Ê¥æÔºü"]
            };
        }

        // Áü•Ë≠ò„Éô„Éº„Çπ„ÇílocalStorage„Å´‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
        function saveKnowledge() {
            try {
                localStorage.setItem(KNOWLEDGE_KEY, JSON.stringify(knowledgeBase));
            } catch (e) {
                console.error("localStorage„Å∏„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:", e);
                addMessage('ai', '„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ„ÄÅÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü‚Ä¶„ÄÇ');
            }
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏„Çí„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„ÇØ„Çπ„Å´ËøΩÂä†„Åô„ÇãÈñ¢Êï∞
        function addMessage(sender, text, isTraining = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            if (isTraining) {
                messageDiv.classList.add('train-message');
            }
            messageDiv.innerHTML = text; // HTML„Çø„Ç∞„ÇíËß£Èáà„Åß„Åç„Çã„Çà„ÅÜ„Å´innerHTML„Çí‰ΩøÁî®
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // ‰∏ÄÁï™‰∏ã„Åæ„Åß„Çπ„ÇØ„É≠„Éº„É´
        }

        // --- ÊñáÂ≠óÂàó„ÅÆÈ°û‰ººÂ∫¶„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞ ---
        // „É¨„Éº„Éô„É≥„Ç∑„É•„Çø„Ç§„É≥Ë∑ùÈõ¢„ÇíË®àÁÆóÔºàÊñáÂ≠óÂàó„ÇíÂà•„ÅÆÊñáÂ≠óÂàó„Å´Â§âÂΩ¢„Åô„Çã„ÅÆ„Å´ÂøÖË¶Å„Å™Á∑®ÈõÜÊìç‰Ωú„ÅÆÊúÄÂ∞èÂõûÊï∞Ôºâ
        function levenshteinDistance(s1, s2) {
            const m = s1.length;
            const n = s2.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(null));

            for (let i = 0; i <= m; i++) {
                dp[i][0] = i;
            }
            for (let j = 0; j <= n; j++) {
                dp[0][j] = j;
            }

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    const cost = (s1[i - 1] === s2[j - 1]) ? 0 : 1;
                    dp[i][j] = Math.min(
                        dp[i - 1][j] + 1,      // ÂâäÈô§
                        dp[i][j - 1] + 1,      // ÊåøÂÖ•
                        dp[i - 1][j - 1] + cost // ÁΩÆÊèõ
                    );
                }
            }
            return dp[m][n];
        }

        // AI„ÅÆÂøúÁ≠î„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞ÔºàÊé®Ê∏¨„Å®Â≠¶ÁøíÔºâ
        function generateResponse(message) {
            const lowerCaseMessage = message.toLowerCase(); // Â∞èÊñáÂ≠ó„Å´Â§âÊèõ„Åó„Å¶Âá¶ÁêÜ

            // --- 1. Â≠¶Áøí„É¢„Éº„Éâ„ÅÆÂà§ÂÆö ---
            // „Äå[„Ç≠„Éº„ÉØ„Éº„Éâ] „Åß [ËøîÁ≠îÊñá]„Äç„ÅÆÂΩ¢Âºè„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const trainMatch = lowerCaseMessage.match(/(.+) „Åß (.+)/);
            if (trainMatch) {
                const keyword = trainMatch[1].trim();
                const responseText = trainMatch[2].trim();

                if (!knowledgeBase[keyword]) {
                    knowledgeBase[keyword] = []; // Êñ∞„Åó„ÅÑ„Ç≠„Éº„ÉØ„Éº„Éâ„Å™„ÇâÈÖçÂàó„ÇíÂàùÊúüÂåñ
                }
                knowledgeBase[keyword].push(responseText); // ËøîÁ≠î„Éë„Çø„Éº„É≥„ÇíËøΩÂä†
                saveKnowledge(); // Â≠¶Áøí„Åó„Åü„Çâ‰øùÂ≠òÔºÅ
                addMessage('ai', `„Äå**${keyword}**„Äç„ÅÆÊñ∞„Åó„ÅÑËøîÁ≠î„Éë„Çø„Éº„É≥„Äå**${responseText}**„Äç„ÇíË¶ö„Åà„Åü„ÇàÔºÅ„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ`, true);
                return null; // AI„Åã„Çâ„ÅÆÂç≥ÊôÇÂøúÁ≠î„ÅØ„Å™„Åó
            }

            // --- 2. Áõ¥Êé•‰∏ÄËá¥„Åô„ÇãÁü•Ë≠ò„Åå„ÅÇ„Çã„Åã„ÄÅ„Åæ„Åü„ÅØÊé®Ê∏¨„É¢„Éº„Éâ ---
            let bestMatchKeyword = null;
            let minDistance = Infinity; // ÊúÄÂ∞è„É¨„Éº„Éô„É≥„Ç∑„É•„Çø„Ç§„É≥Ë∑ùÈõ¢
            let foundDirectMatch = false;

            // ÂÖ•Âäõ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂçòË™û„Å´ÂàÜËß£„Åó„Å¶„ÄÅ„Åù„Çå„Åû„Çå„ÅÆÂçòË™û„ÅßÁü•Ë≠ò„Éô„Éº„Çπ„ÇíÊ§úÁ¥¢
            const words = lowerCaseMessage.split(/\s+|[„ÄÅ„ÄÇÔºüÔºÅ‚Ä¶]+/); // „Çπ„Éö„Éº„Çπ„ÇÑÂè•Ë™≠ÁÇπ„ÅßÂàÜÂâ≤

            for (const word of words) {
                if (word.trim() === '') continue; // Á©∫„ÅÆÂçòË™û„ÅØ„Çπ„Ç≠„ÉÉ„Éó

                for (const knownKey in knowledgeBase) {
                    const lowerCaseKnownKey = knownKey.toLowerCase();
                    
                    // ÂÆåÂÖ®‰∏ÄËá¥„ÇíÂÑ™ÂÖà
                    if (word === lowerCaseKnownKey) {
                        bestMatchKeyword = knownKey;
                        foundDirectMatch = true;
                        break; // ÂÆåÂÖ®‰∏ÄËá¥„ÅåË¶ã„Å§„Åã„Å£„Åü„Çâ„ÄÅ„Åì„Çå‰ª•‰∏äÊé¢„ÅôÂøÖË¶Å„ÅØ„Å™„ÅÑ
                    }

                    // ÂÆåÂÖ®‰∏ÄËá¥„Åß„Å™„Åë„Çå„Å∞„É¨„Éº„Éô„É≥„Ç∑„É•„Çø„Ç§„É≥Ë∑ùÈõ¢„ÅßÈ°û‰ººÂ∫¶„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    const distance = levenshteinDistance(word, lowerCaseKnownKey);
                    
                    // „ÅÇ„ÇãÁ®ãÂ∫¶„ÅÆËøë„ÅïÔºàÈñæÂÄ§Ôºâ„ÇíË®≠ÂÆö„ÄÇ‰ªäÂõû„ÅØÂçòË™û„ÅÆÈï∑„Åï„ÅÆÂçäÂàÜ‰ª•‰∏ã„ÇíÁõÆÂÆâ„Å´„ÄÇ
                    if (distance <= Math.ceil(lowerCaseKnownKey.length / 2) && distance < minDistance) {
                        minDistance = distance;
                        bestMatchKeyword = knownKey;
                    }
                }
                if (foundDirectMatch) break; // Â§ñÂÅ¥„ÅÆ„É´„Éº„Éó„ÇÇÊäú„Åë„Çã
            }

            if (bestMatchKeyword) {
                // ÂøúÁ≠î„ÅÆ„Éë„Çø„Éº„É≥„É™„Çπ„Éà„Åã„Çâ„É©„É≥„ÉÄ„É†„Å´‰∏Ä„Å§ÈÅ∏„Å∂
                const responses = knowledgeBase[bestMatchKeyword];
                const randomIndex = Math.floor(Math.random() * responses.length);
                const chosenResponse = responses[randomIndex];

                if (foundDirectMatch) {
                    // Áõ¥Êé•‰∏ÄËá¥„Å™„Çâ„Åù„ÅÆ„Åæ„ÅæÂøúÁ≠î
                    return chosenResponse;
                } else {
                    // Êé®Ê∏¨„Å™„Çâ„Äå„ÇÇ„Åó„Åã„Åó„Å¶Ôºü„Äç„Çí‰ªò„ÅëÂä†„Åà„Çã
                    return `„Çì„Éº„ÄÅ„ÇÇ„Åó„Åã„Åó„Å¶„Äå${bestMatchKeyword}„Äç„ÅÆ„Åì„Å®„Åã„Å™Ôºü\n„Åù„Çå„Å™„Çâ„ÄÅ„Äå${chosenResponse}„Äç„Å†„Çà„ÄÇ`;
                }
            } else {
                // ÂÖ®„ÅèÊé®Ê∏¨„Åß„Åç„Å™„ÅÑÂ†¥Âêà
                return "„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ„ÄÅ„Çà„ÅèÂàÜ„Åã„Çä„Åæ„Åõ„Çì„ÄÇÊñ∞„Åó„ÅÑ‰ºöË©±„Éë„Çø„Éº„É≥„ÇíÊïô„Åà„Å¶„Åè„Çå„Çã„Å®„ÄÅ„ÇÇ„Å£„Å®„Åä„Åó„ÇÉ„Åπ„Çä„Åß„Åç„Çã„ÇàÔºÅ„Äå**[„Ç≠„Éº„ÉØ„Éº„Éâ] „Åß [ËøîÁ≠îÊñá]**„Äç„ÅÆ„Çà„ÅÜ„Å´Êïô„Åà„Å¶„Å≠ÔºÅ";
            }
        }

        // ÈÄÅ‰ø°„Éú„Çø„É≥„ÅåÊäº„Åï„Çå„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        function sendMessage() {
            const message = userInput.value.trim();
            if (message === '') return;

            addMessage('user', message);
            userInput.value = '';

            setTimeout(() => {
                const aiResponse = generateResponse(message);
                if (aiResponse) {
                    addMessage('ai', aiResponse);
                }
            }, 500);
        }

        // Enter„Ç≠„Éº„ÅßÈÄÅ‰ø°„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åô„Çã
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´AI„ÇíÂàùÊúüÂåñ„Åô„Çã
        initializeAI();
    </script>
</body>
</html>
